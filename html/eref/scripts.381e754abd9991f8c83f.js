!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/forms"),require("rxjs/operators"),require("rxjs"),require("@angular/core")):"function"==typeof define&&define.amd?define("nthm",["exports","@angular/common","@angular/forms","rxjs/operators","rxjs","@angular/core"],e):e(t.nthm={},t.ng.common,t.ng.forms,t.rxjs.operators,t.rxjs,t.ng.core)}(this,function(t,e,n,i,r,s){"use strict";function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}function a(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}var l=Object.freeze(["direction","boxSizing","width","height","minHeight","minWidth","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"]),h="undefined"!=typeof window,p=h&&null!=window.mozInnerScreenX;function c(t){return null!==t&&("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName||"#text"===t.nodeName)}function u(t,e,n,i,r){return isNaN(n)?n:(function(t,e,n,i,r){var s,o=0,l=0,h=e.regEx;for(h.lastIndex=0;null!==(s=h.exec(t));){var p=r.apply(void 0,a(s)),c=t.substring(o,s.index);n(c,o,l),i(s[0],s.index,l+=c.length,p),l+=p.length,o=h.lastIndex}o<t.length&&n(t.substring(o),o,l)}(t,e,function(t,e,i){void 0===s&&i+t.length>=n&&(s=e+n-i)},function(t,e,r,o){void 0===s&&r+o.length>n&&(s=e+(i?t.length:0))},r),void 0!==s?s:t.length);var s}function g(t,e){var n=window.getComputedStyle?getComputedStyle(t):t.currentStyle;return e&&"string"==typeof e&&void 0!==n[e]?n[e]:e&&"string"==typeof e?null:n}function m(t,e){if(c(t)&&void 0!==t.selectionStart)t.focus(),t.setSelectionRange(e,e);else{var n=document.createRange();n.setStart(t,e),n.collapse(!0);var i=window.getSelection();i.removeAllRanges(),i.addRange(n)}}function d(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function f(t){var e,n=/__([\w]+)__/g,i=d(t),r={},s=1;do{if(e=n.exec(i)){var o=e[1];i=i.replace("__"+o+"__","([^\\)\\]]+)"),r[o]=++s}}while(e);return{markup:t,regEx:new RegExp("("+i+")","ig"),groups:r}}function y(t,e,n,i){var r={start:-1,end:-1};return function(t,e,n,i){var r,s=0,o=0,l=e.regEx;for(l.lastIndex=0;null!==(r=l.exec(t));){var h=i.apply(void 0,a(r));n(0,0,o+=t.substring(s,r.index).length,h),o+=h.length,s=l.lastIndex}}(t,e,function(t,e,i,s){return i<n&&i+s.length>n&&(r={start:i,end:i+s.length},!0)},i),r}function v(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}var b=function(){function t(t,e){void 0===e&&(e=null),this.element=t,this.type=e}return Object.defineProperty(t.prototype,"clientRect",{get:function(){return this.element.getBoundingClientRect()},enumerable:!0,configurable:!0}),t}(),x=function(){function t(){var t=this;this.format=function(e){var n,i;if("string"==typeof t.markupReplace){var r=void 0,s=[t.markupReplace,"$"+t.markupReplace,"$"+t.markupMention.groups[t.markupReplace]];try{for(var o=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}(s),a=o.next();!a.done;a=o.next()){var l=a.value;if((r=e.replace(t.markupMention.regEx,l))!==l)break}}catch(h){n={error:h}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return r}return"function"==typeof t.markupReplace?t.markupReplace(e):e}}return t.prototype.ngOnInit=function(){this.markup&&(this.markupMention=f(this.markup))},t.prototype.ngOnChanges=function(t){"markup"in t&&(this.markupMention=f(this.markup))},t.prototype.match=function(t){return this.markupMention?this.markupMention.regEx.exec(t):null},t.decorators=[{type:s.Directive,args:[{exportAs:"ngHighlighterPattern",selector:"ng-highlighter-pattern"}]}],t.propDecorators={className:[{type:s.Input}],markup:[{type:s.Input}],markupReplace:[{type:s.Input}]},t}(),w=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null),this.type=null,this.rel=null,this.content=t,this.type=e,this.rel=n},E=function(){function t(t,e){this.element=t,this.cdr=e,this.itemClick=new s.EventEmitter,this.newLine=/\n/g,this.lines=[],this.highlightedElements=[]}return t.prototype.ngOnChanges=function(t){"text"in t&&this.parseLines()},t.prototype.ngAfterContentInit=function(){this.text&&this.patterns&&this.parseLines()},t.prototype.onItemClick=function(t){var e=this.getMatchedElement(t);if(e){t.preventDefault(),t.stopPropagation();var n=e.element.innerText,i=e.element.getAttribute("rel")||null,r=e.element.querySelector("[rel]");r&&(i=r.getAttribute("rel")||null),this.itemClick.emit(new w(n,e.type,i))}},t.prototype.parseLines=function(){var t=this;this.lines=this.text.split(this.newLine).map(function(e){return t.highlight(e)}),this.cdr.detectChanges(),this.collectHighlightedItems()},t.prototype.highlight=function(t){if(0===t.length||!this.patterns)return"&nbsp;";var e,n=[];this.patterns.forEach(function(i){for(;null!==(e=i.match(t));)n.push({type:i.className,indices:{start:e.index,end:e.index+e[0].length},formatter:i.format})});var i=[],r=[];a(n).sort(function(t,e){return t.indices.start-e.indices.start}).forEach(function(e){var n=e.indices.end-e.indices.start,s=t.slice(e.indices.start,e.indices.end);if(s.length===n){var o=t.slice(i.length>0?i[i.length-1].indices.end:0,e.indices.start);r.push(v(o)),r.push('<span class="highlighted '+(e.type||"")+'" rel="'+e.type+'">'+e.formatter(s)+"</span>"),i.push(e)}});var s=t.slice(i.length>0?i[i.length-1].indices.end:0);return r.push(v(s)),r.push("&nbsp;"),r.join("")},t.prototype.getMatchedElement=function(t){return this.highlightedElements.find(function(e){return r=t.clientY,(n=e.clientRect).left<(i=t.clientX)&&i<n.right&&n.top<r&&r<n.bottom;var n,i,r})||null},t.prototype.collectHighlightedItems=function(){this.highlightedElements=Array.from(this.element.nativeElement.getElementsByClassName("highlighted")).map(function(t){var e=t.getAttribute("rel")||null;return new b(t,e)})},t.decorators=[{type:s.Component,args:[{exportAs:"ngHighlighter",selector:"ng-highlighter",template:'<div *ngFor="let line of lines" [innerHTML]="line"></div>',preserveWhitespaces:!1,encapsulation:s.ViewEncapsulation.None}]}],t.ctorParameters=function(){return[{type:s.ElementRef},{type:s.ChangeDetectorRef}]},t.propDecorators={text:[{type:s.Input}],itemClick:[{type:s.Output}],patterns:[{type:s.ContentChildren,args:[x]}],onItemClick:[{type:s.HostListener,args:["click",["$event"]]}]},t}(),S={Backspace:8,Tab:9,Enter:13,Shift:16,Escape:27,Space:32,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40};S[S.Backspace]="Backspace",S[S.Tab]="Tab",S[S.Enter]="Enter",S[S.Shift]="Shift",S[S.Escape]="Escape",S[S.Space]="Space",S[S.End]="End",S[S.Home]="Home",S[S.ArrowLeft]="ArrowLeft",S[S.ArrowUp]="ArrowUp",S[S.ArrowRight]="ArrowRight",S[S.ArrowDown]="ArrowDown";var C=function(){function t(){this.activeIndex=-1,this.itemSelected=new s.EventEmitter,this.show=!1,this.dropUp=!1,this._top=0,this._left=0}return Object.defineProperty(t.prototype,"selectedItem",{get:function(){return this.activeIndex>=0&&void 0!==this.items[this.activeIndex]?this.items[this.activeIndex]:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._top+this.adjustTop+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._left+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"noItems",{get:function(){return!Array.isArray(this.items)||0===this.items.length},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.itemTemplate||(this.itemTemplate=this.defaultItemTemplate)},t.prototype.onItemClick=function(t,e,n){t.preventDefault(),this.activeIndex=e,this.itemSelected.emit(n)},t.prototype.selectFirstItem=function(){this.activeIndex=0,this.resetScroll()},t.prototype.selectPreviousItem=function(){this.activeIndex>0&&this.activeIndex--,this.scrollToActiveItem()},t.prototype.selectNextItem=function(){this.activeIndex<this.items.length-1&&(this.activeIndex++,this.scrollToActiveItem())},t.prototype.selectLastItem=function(){this.activeIndex=this.items.length>0?this.items.length-1:0,this.scrollToActiveItem()},t.prototype.position=function(){var t=this.textAreaElement,e=function(t,e){var n={top:0,left:0};if(!h)return n;var i=document.createElement("div");document.body.appendChild(i);var r=i.style,s=g(t);r.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(r.wordWrap="break-word"),r.position="absolute",r.visibility="hidden",l.forEach(function(t){return r[t]=s[t]}),p?t.scrollHeight>parseInt(s.height,10)&&(r.overflowY="scroll"):r.overflow="hidden",i.textContent=t.value.substring(0,e),"INPUT"===t.nodeName&&(i.textContent=i.textContent.replace(/\s/g,"\xa0"));var o=document.createElement("span");o.textContent=t.value.substring(e)||".",i.appendChild(o);var a=0;return t.scrollTop>0&&(a=t.scrollTop),n={top:o.offsetTop+parseInt(s.borderTopWidth,10)-a,left:o.offsetLeft+parseInt(s.borderLeftWidth,10)},document.body.removeChild(i),n}(t,t.selectionStart);this._top=e.top,this._left=e.left+t.offsetLeft,this.list.nativeElement.scrollTop=0},t.prototype.resetScroll=function(){this.list.nativeElement.scrollTop=0},t.prototype.transformItem=function(t){return this.displayTransform(t)||t},Object.defineProperty(t.prototype,"adjustTop",{get:function(){var t=0;if(!this.dropUp){var e=g(this.textAreaElement,"fontSize");t=parseInt(e,10)+this.textAreaElement.offsetTop}return t},enumerable:!0,configurable:!0}),t.prototype.scrollToActiveItem=function(){var t=this.list.nativeElement;if(0===this.activeIndex)t.scrollTop=0;else{var e=t.querySelector("li.active");e&&(t.scrollTop=e.offsetTop)}},t.decorators=[{type:s.Component,args:[{selector:"mentions-list",template:'\n      <ng-template #defaultItemTemplate let-item="item">\n          {{transformItem(item)}}\n      </ng-template>\n      <ul #list class="dropdown-menu scrollable-menu">\n          <li *ngFor="let item of items; let i = index" [class.active]="activeIndex === i">\n              <a href class="dropdown-item" (click)="onItemClick($event, i, item)">\n                  <ng-template [ngTemplateOutlet]="itemTemplate"\n                               [ngTemplateOutletContext]="{item:item,index:i}"></ng-template>\n              </a>\n          </li>\n      </ul>\n  ',encapsulation:s.ViewEncapsulation.None,styles:["mentions-list {position: absolute;display: none;}","mentions-list.drop-up {transform: translateY(-100%);}","mentions-list.show {display: block;} mentions-list.no-items {display: none;}","mentions-list .scrollable-menu {display: block;height: auto;max-height:300px;overflow:auto;}","mentions-list li.active {background: #f7f7f9;}"]}]}],t.propDecorators={defaultItemTemplate:[{type:s.ViewChild,args:["defaultItemTemplate"]}],list:[{type:s.ViewChild,args:["list"]}],show:[{type:s.HostBinding,args:["class.show"]}],dropUp:[{type:s.HostBinding,args:["class.drop-up"]}],top:[{type:s.HostBinding,args:["style.top"]}],left:[{type:s.HostBinding,args:["style.left"]}],noItems:[{type:s.HostBinding,args:["class.no-items"]}]},t}(),I=function(){function t(t,e,n,i,o){this.element=t,this.componentResolver=e,this.viewContainer=n,this.changeDetector=i,this.ngZone=o,this.triggerChar="@",this.mentionMarkup="@[__display__](__type__:__id__)",this.disableSearch=!1,this.maxItems=-1,this.dropUp=!1,this.displayName="display",this.search=new s.EventEmitter,this.valueChanges=new s.EventEmitter,this.stateChanges=new r.Subject,this.displayContent="",this.lines=[],this.highlighterStyle={},this.textAreaClassNames={},this.mentions=[],this._value="",this._rows=1,this._columns=20,this.stopSearch=!1,this._destroyed=new r.Subject,this.newLine=/\n/g,this._errorState=!1}return Object.defineProperty(t.prototype,"formClass",{get:function(){return Object.keys(this.textAreaClassNames).join(" ")},set:function(t){var e=this;this.textAreaClassNames={},Array.from(t.split(" ")).forEach(function(t){e.textAreaClassNames[t]=!0})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this.parseLines(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"required",{get:function(){return this._required},set:function(t){this._required=t,this.refreshStyles()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return this._disabled},set:function(t){this._disabled=t,this.refreshStyles()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},set:function(t){null!=t&&("string"==typeof t&&(t=parseInt(t,10)),this._rows=Math.max(1,t),this.refreshStyles())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._columns},set:function(t){null!=t&&("string"==typeof t&&(t=parseInt(t,10)),this._columns=Math.max(1,t),this.refreshStyles())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mentionItems",{set:function(t){this.mentions=t,this.disableSearch&&this.mentionsList&&(this.mentionsList.items=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readonly",{get:function(){return this.disabled?"readonly":null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorState",{get:function(){return this._errorState},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.parseMarkup()},t.prototype.ngOnChanges=function(t){"markup"in t&&this.parseMarkup()},t.prototype.ngAfterViewInit=function(){this.parseLines(this._value),this.refreshStyles()},t.prototype.ngAfterViewChecked=function(){this.refreshStyles()},t.prototype.ngOnDestroy=function(){this._destroyed.next(),this._destroyed.complete()},t.prototype.onWindowResize=function(){this.refreshStyles()},t.prototype.onTextAreaScroll=function(){this.highlighterElement.nativeElement.scrollTop=this.textAreaInputElement.nativeElement.scrollTop},t.prototype.onSelect=function(t){this.selectionStart=t.target.selectionStart,this.selectionEnd=t.target.selectionEnd},t.prototype.onChange=function(t){var e=this,n=this._value,i=this.displayTransform.bind(this),r=this.textAreaInputElement.nativeElement.selectionStart,s=this.textAreaInputElement.nativeElement.selectionEnd,o=function(e,n,i,s){return y(t,n,r,s)}(0,this.markupSearch,0,i);-1!==o.start&&(t=t.substring(0,o.start)+t.substring(o.end));var a=function(t,e,n,i,r,s,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=0);var a=function(t,e,n){return e.regEx.lastIndex=0,t.replace(e.regEx,n)}(t,e,o),l=a.length-n.length;i||(i=r+l),r||(r=i),i===r&&r===s&&a.length===n.length&&i--;var h=n.slice(i,s),p=Math.min(i,s),c=r;return i===s&&(c=Math.max(r,i+l)),function(t,e,n,i){return t.substring(0,e)+i+t.substring(n)+""}(t,u(t,e,p,!1,o),u(t,e,c,!0,o),h)}(n,this.markupSearch,t,this.selectionStart,this.selectionEnd,s,i),l=y(n,this.markupSearch,r,i);l.start>-1&&this.selectionEnd>l.start&&(s=r=l.start),this.selectionStart=Math.max(r,0),this.selectionEnd=Math.max(s,0),this.parseLines(a),this.selectionEnd>0&&setTimeout(function(){return m(e.textAreaInputElement.nativeElement,e.selectionEnd)})},t.prototype.onKeyDown=function(t){var e=function(t){if(c(t))return t.value.slice(0,t.selectionStart).length;var e=window.getSelection();return e.rangeCount>0?e.getRangeAt(0).startOffset:0}(this.textAreaInputElement.nativeElement),n=t.key,i=t.which||t.keyCode;if(!n){var r=t.which||t.keyCode;n=String.fromCharCode(r),!t.shiftKey&&r>=65&&r<=90&&(n=String.fromCharCode(r+32))}i===S.Enter&&t.wasSelection&&e<this.startPos&&m(this.startNode,e=this.startNode.length);var s=y(this._value,this.markupSearch,e,this.displayTransform.bind(this));n===this.triggerChar?this.setupMentionsList(e):-1===s.start&&this.startPos>=0?e<=this.startPos?(this.mentionsList.show=!1,this.startPos=-1):i===S.Shift||t.shiftKey||t.metaKey||t.altKey||t.ctrlKey||!(e>this.startPos)||this.handleKeyDown(t,e,n):this.onSelect({target:this.textAreaInputElement.nativeElement})},t.prototype.onBlur=function(t){t instanceof FocusEvent&&t.relatedTarget&&t.relatedTarget.classList.contains("dropdown-item")||(this.stopEvent(t),this.mentionsList&&(this.mentionsList.show=!1))},t.prototype.isPartMention=function(t){return void 0!==t.contents},t.prototype.formatMention=function(t){return this._formatMention(t.contents)},t.prototype.displayTransform=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.markupSearch.groups[this.displayName];return t[n]},t.prototype._formatMention=function(t){var e="$"+this.displayName,n=t.replace(this.markupSearch.regEx,e);return n===e&&(n=t.replace(this.markupSearch.regEx,"$"+this.markupSearch.groups[this.displayName])),n},t.prototype.stopEvent=function(t){t.preventDefault&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())},t.prototype.setupMentionsList=function(t){this.startPos=t,this.startNode=window.getSelection().anchorNode,this.searchString="",this.stopSearch=!1,this.showMentionsList(),this.updateMentionsList()},t.prototype.handleKeyDown=function(t,e,n){var i=this,r=t.which||t.keyCode;if(r===S.Space)this.startPos=-1;else if(r===S.Backspace&&e>0)--e===this.startPos&&(this.stopSearch=!0),this.mentionsList.show=!this.stopSearch;else if(this.mentionsList.show){if(r===S.Tab||r===S.Enter){this.stopEvent(t),this.mentionsList.show=!1;var s=this._value,o=u(s,this.markupSearch,this.startPos,!1,this.displayTransform.bind(this)),a=function(t,e){var n=e.markup+"";return Object.keys(e.groups).forEach(function(e){return n=n.replace(new RegExp("__"+e+"__","g"),"string"==typeof t?t:t[e])}),n}(t.item||this.mentionsList.selectedItem,this.markupSearch),l=this._formatMention(a);e=this.startPos+l.length;var h=this.searchString||"";return s=s.substring(0,o)+a+s.substring(o+h.length+1,s.length),this.parseLines(s),this.startPos=-1,this.searchString="",this.stopSearch=!0,this.mentionsList.show=!1,this.changeDetector.detectChanges(),void setTimeout(function(){m(i.textAreaInputElement.nativeElement,e),i.onSelect({target:i.textAreaInputElement.nativeElement})})}if(r===S.Escape)return this.stopEvent(t),this.mentionsList.show=!1,void(this.stopSearch=!0);if(r===S.ArrowDown)return this.stopEvent(t),void this.mentionsList.selectNextItem();if(r===S.ArrowUp)return this.stopEvent(t),void this.mentionsList.selectPreviousItem();if(r===S.Home)return this.stopEvent(t),void this.mentionsList.selectFirstItem();if(r===S.End)return this.stopEvent(t),void this.mentionsList.selectLastItem()}if(r!==S.ArrowLeft&&r!==S.ArrowRight&&r!==S.Home&&r!==S.End){var p=this.displayContent.substring(this.startPos+1,e);r!==S.Backspace&&(p+=n),this.searchString=p||"",this.updateMentionsList()}else this.onSelect(t)},t.prototype.getDisplayValue=function(t){return"string"==typeof t?t:void 0!==t[this.displayName]?t[this.displayName]:null},t.prototype.showMentionsList=function(){var t=this;if(!this.mentionsList){var e=this.componentResolver.resolveComponentFactory(C),n=this.viewContainer.createComponent(e);this.mentionsList=n.instance,this.mentionsList.itemTemplate=this.mentionListTemplate,this.mentionsList.displayTransform=this.displayTransform.bind(this),this.mentionsList.itemSelected.subscribe(function(e){t.textAreaInputElement.nativeElement.focus(),t.onKeyDown({keyCode:S.Enter,wasSelection:!0,item:e})}),this.mentionsList.displayTransform=this.getDisplayValue.bind(this)}this.mentionsList.textAreaElement=this.textAreaInputElement.nativeElement,this.mentionsList.show=!0,this.mentionsList.dropUp=this.dropUp,this.mentionsList.activeIndex=0,this.mentionsList.position(),this.ngZone.run(function(){return t.mentionsList.resetScroll()})},t.prototype.updateMentionsList=function(){var t=this;if(this.disableSearch)this.search.emit(this.searchString);else{var e=Array.from(this.mentions);if(this.searchString){var n=this.searchString.toLowerCase(),i=new RegExp(d(n),"i");e=e.filter(function(e){var n=t.getDisplayValue(e);return null!==n&&i.test(n)}),this.maxItems>0&&(e=e.slice(0,this.maxItems))}this.mentionsList.items=e}},t.prototype.parseMarkup=function(){if(0===this.mentionMarkup.length||this.mentionMarkup[0]!==this.triggerChar)throw new Error('ng-mentions markup pattern must start with the trigger character "'+this.triggerChar+'"');this.markupSearch=f(this.mentionMarkup)},t.prototype.parseLines=function(t){var e=this;if(void 0===t&&(t=""),t!==this._value){var n=(t=t||"").split(this.newLine).map(function(t){return e.formatMentions(t)}),i=n.map(function(t){return t.content}).join("\n");this.displayContent!==i&&(this.lines=n,this.displayContent=i,this.triggerChange(t))}},t.prototype.formatMentions=function(t){var e,n=this,i={originalContent:t,content:t,parts:[]};if(0===t.length)return i;var r=[],s=this.markupSearch.regEx;for(s.lastIndex=0;null!==(e=s.exec(t));)r.push({indices:{start:e.index,end:e.index+e[0].length}});var o=[],l="";a(r).sort(function(t,e){return t.indices.start-e.indices.start}).forEach(function(e){var r=e.indices.end-e.indices.start,s=t.slice(e.indices.start,e.indices.end);if(s.length===r){var a=t.slice(o.length>0?o[o.length-1].indices.end:0,e.indices.start),h={contents:s,tag:e};i.parts.push(a),i.parts.push(h),o.push(e),l+=a+n.formatMention(h)}});var h=t.slice(o.length>0?o[o.length-1].indices.end:0);return i.parts.push(h),i.content=l+=h,i},t.prototype.refreshStyles=function(){var t=this,e=getComputedStyle(this.textAreaInputElement.nativeElement);this.highlighterStyle={},l.forEach(function(n){t.highlighterStyle[n]=e[n]}),this.changeDetector.detectChanges()},t.prototype.triggerChange=function(t){this._value=t,this.valueChanges.emit(this._value),this.changeDetector.detectChanges()},t.decorators=[{type:s.Component,args:[{exportAs:"ngMentions",selector:"ng-mentions",template:'\n      <div #highlighter class="highlighter" [ngClass]="textAreaClassNames" [attr.readonly]="readonly"\n           [ngStyle]="highlighterStyle">\n          <div *ngFor="let line of lines">\n              <ng-container *ngFor="let part of line.parts">\n                  <highlighted *ngIf="isPartMention(part)" [tag]="part.tag">{{formatMention(part)}}</highlighted>\n                  <ng-container *ngIf="!isPartMention(part)">{{part}}</ng-container>\n              </ng-container>\n              &nbsp;\n          </div>\n      </div>\n      <textarea\n        #input\n        [rows]="rows"\n        [cols]="columns"\n        [ngModel]="displayContent"\n        [ngClass]="textAreaClassNames"\n        (keydown)="onKeyDown($event)"\n        (blur)="onBlur($event)"\n        (select)="onSelect($event)"\n        (mouseup)="onSelect($event)"\n        (ngModelChange)="onChange($event)"\n        (scroll)="onTextAreaScroll()"\n        [disabled]="disabled"\n        [required]="required"\n        [placeholder]="placeholder"\n      ></textarea>\n  ',preserveWhitespaces:!1,encapsulation:s.ViewEncapsulation.None,styles:["ng-mentions {position: relative; display: inline-block;}","ng-mentions textarea {position:relative; background-color: transparent !important;}","ng-mentions .highlighter {\n        position: absolute;\n        top:      0;\n        left:     0;\n        right:    0;\n        bottom:   0;\n        color:    transparent;\n        overflow: hidden !important;\n    }","ng-mentions highlighted {\n        display:          inline;\n        border-radius:    3px;\n        padding:          1px;\n        margin:           -1px;\n        overflow-wrap:    break-word;\n        background-color: lightblue;\n    }"]}]}],t.ctorParameters=function(){return[{type:s.ElementRef},{type:s.ComponentFactoryResolver},{type:s.ViewContainerRef},{type:s.ChangeDetectorRef},{type:s.NgZone}]},t.propDecorators={triggerChar:[{type:s.Input,args:["triggerChar"]}],mentionMarkup:[{type:s.Input,args:["markup"]}],disableSearch:[{type:s.Input,args:["disableSearch"]}],maxItems:[{type:s.Input,args:["maxItems"]}],dropUp:[{type:s.Input,args:["dropUp"]}],displayName:[{type:s.Input,args:["displayName"]}],formClass:[{type:s.Input,args:["formClass"]}],placeholder:[{type:s.Input,args:["placeholder"]}],value:[{type:s.Input,args:["value"]}],required:[{type:s.Input,args:["required"]}],disabled:[{type:s.Input,args:["disabled"]}],rows:[{type:s.Input,args:["rows"]}],columns:[{type:s.Input,args:["cols"]}],mentionItems:[{type:s.Input,args:["mentions"]}],search:[{type:s.Output,args:["search"]}],valueChanges:[{type:s.Output,args:["valueChanges"]}],stateChanges:[{type:s.Output,args:["stateChanges"]}],mentionListTemplate:[{type:s.ContentChild,args:[s.TemplateRef]}],textAreaInputElement:[{type:s.ViewChild,args:["input"]}],highlighterElement:[{type:s.ViewChild,args:["highlighter"]}],onWindowResize:[{type:s.HostListener,args:["window:resize"]}]},t}(),k=function(){function t(t,e){this.element=t,this.host=e,this._destroyed=new r.Subject}return t.prototype.ngOnInit=function(){var t=this;this.host.valueChanges.pipe(i.takeUntil(this._destroyed)).subscribe(function(e){return t.onChange(e)})},t.prototype.ngOnDestroy=function(){this._destroyed.next(),this._destroyed.complete()},t.prototype.registerOnChange=function(t){this._onChange=t},t.prototype.registerOnTouched=function(t){this._onTouch=t},t.prototype.setDisabledState=function(t){this.host.disabled=t},t.prototype.writeValue=function(t){"string"!=typeof t&&null!==t||(this.host.value=t)},t.prototype.onChange=function(t){this._onChange&&"object"!=typeof t&&this._onChange(t)},t.prototype.onTouched=function(){this._onTouch&&this._onTouch()},t.decorators=[{type:s.Directive,args:[{exportAs:"ngMentions",selector:"ng-mentions",host:{"(change)":"onChange($event)","(touch)":"onTouched()"},providers:[{provide:n.NG_VALUE_ACCESSOR,useExisting:s.forwardRef(function(){return t}),multi:!0}]}]}],t.ctorParameters=function(){return[{type:s.ElementRef},{type:I}]},t}(),_=function(){function t(){}return t.decorators=[{type:s.Directive,args:[{selector:"highlighted"}]}],t.propDecorators={tag:[{type:s.Input}]},t}(),A=[I,k,E,x],L=[I,k,C,_,E,x],T=function(){function t(){}return t.decorators=[{type:s.NgModule,args:[{imports:[e.CommonModule,n.FormsModule],exports:A,declarations:L,entryComponents:[C]}]}],t}();t.NgHighlighterComponent=E,t.NgMentionsAccessorDirective=k,t.NgMentionsComponent=I,t.NgMentionsModule=T,t.\u0275a=x,t.\u0275c=_,t.\u0275b=C,Object.defineProperty(t,"__esModule",{value:!0})});